<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>JUnit5 , 스프링 부트 테스트 내용 추가</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="e72c0d3f-dcb5-4c9e-a5c8-56185ce268a5" class="page sans"><header><div class="page-header-icon undefined"><span class="icon">🌺</span></div><h1 class="page-title">JUnit5 , 스프링 부트 테스트 내용 추가</h1></header><div class="page-body"><nav id="bbacea45-3a49-47cf-998e-c8de7c89ad68" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e3af9b20-a269-4705-a406-bdc5e4eebba2">01. <code>@SpringBootTest</code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6299838e-a9e8-4cae-8fe0-30fac29754d9">01-1. <code>@SpringBootTest 파라미터</code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a3f22708-2139-4b64-9ea6-db0959bd79f3">02. <code>@WebMvcTest</code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d2fecbf0-9101-4702-b0c2-148de8cbe030">03. <code>@DataJpaTest</code></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#33cdaa55-5dbd-4ca1-9715-f1abd6e09f71">(부록)TestEntityManager</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a308e4b6-6955-4131-922c-4a8653d22c12">04. <code>@RestClientTest</code></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#68e59135-6679-4973-bea5-76821ac63bd5">05. <code>@JsonTest</code></a></div></nav><h2 id="e3af9b20-a269-4705-a406-bdc5e4eebba2" class="">01. <code>@SpringBootTest</code></h2><ul id="c9db7462-239f-48c5-bcf2-76135f56da7c" class="bulleted-list"><li>통합 테스트 지원</li></ul><ul id="5eea791c-b280-47fd-b6b6-25ffb471a36a" class="bulleted-list"><li>단점: 설정된 빈 모두를 로드해서 어플리케이션 규모가 클수록 속도가 느려짐</li></ul><ul id="4364be0e-c45e-42e0-9c8f-0df56592a805" class="bulleted-list"><li>SpringBoot 1버전까지는 <code>@RunWith(SpringRunner.class)</code>를 붙여야 사용가능했으나, 2버전부터는 <code>@SpringBootTest</code>만 붙여도 적용 가능하다!</li></ul><p id="4e2981a3-2b4b-4dfc-9cea-dd853e1d00f6" class="">
</p><h3 id="6299838e-a9e8-4cae-8fe0-30fac29754d9" class="">01-1. <code>@SpringBootTest 파라미터</code></h3><p id="05eebb51-aa92-410a-9e5a-d2ac2b29e448" class="">ⓐ value : 테스트 실행 전 적용할 프로퍼티 주입 가능</p><ul id="af996ebb-ce08-418c-8433-58187f04af4e" class="bulleted-list"><li>기존의 프로퍼티를 오버라이드</li></ul><p id="2c50135e-3833-4a78-ad03-7ff4b42f42a1" class="">
</p><p id="7ed9ef53-16c5-4318-a304-bb34922795f0" class="">ⓑ properties : 테스트가 실행되기 전에 {key=value} 형식으로 프로퍼티 추가 가능</p><p id="5e56fe83-0811-44ee-96b8-b8ff6b035795" class="">
</p><p id="6b9b4065-6347-4371-847b-734de26f49ba" class="">ⓒ classes : 어플리케이션 컨텍스트에 로드할 클래스 지정 가능</p><ul id="96a8bb12-ace8-49af-a457-944cfcacaed6" class="bulleted-list"><li>따로 지정하지 않으면 <code>@SpringBootConfiguration</code>을 찾아서 로드</li></ul><p id="6bd38628-f5a7-4029-ad4b-7d7c51790d62" class="">
</p><p id="78e9aa8d-e51c-4dae-b744-694d7fbedc16" class="">ⓓ webEnvironment : 어플리케이션이 실행될 때의 웹 환경 설정 가능</p><ul id="b7fbab94-319a-4d9c-af73-9d43eebf865c" class="bulleted-list"><li>기본값 : Mock 서블릿을 로드</li></ul><ul id="9b473fe6-04d1-4717-af2e-21c5aa603d05" class="bulleted-list"><li>Mock 서블릿 : 개발 환경에 따라 다른 Mock(가짜 객체 주입) 서블릿 ㅗ한경의 어플리케이션 컨텍스트를 선택하여 로드되도록 하는 설정값</li></ul><p id="f70806a8-d2b6-481c-aa56-fa6b696ff7d6" class="">
</p><p id="2f49b0ec-1ebb-4313-ae8f-6713283ba195" class="">
</p><p id="fd94804d-f384-43eb-962e-a954141ccfad" class="">🌟 몇 가지 주의 사항🌟</p><ul id="7a79f62f-5749-4fa0-a343-26ce62e11acd" class="bulleted-list"><li>프로파일 환경(개발, 운영환경, QA[Quality Assurance;품질 보증])마다 다른 data source를 갖는다면 <code>@ActiveProfiles(&quot;local&quot;)</code>과 같은 방식으로 <code>원하는 프로파일 환경값을 부여</code></li></ul><ul id="d6047deb-851d-49b8-9b96-a17693a26443" class="bulleted-list"><li><code>테스트에서 @Transactional을 사용하면 테스트를 마치고 나서 수정된 데이터가 롤백되지만, 테스트가 서버의 다른 스레드에서 실행중이면, WebEnvironment의 RANDOM_PORT 나 DEFINED_PORT를 사용하면 롤백되지 않는다!</code></li></ul><ul id="1f7ebb60-495a-4e71-80bf-4712afd72ee0" class="bulleted-list"><li><code>@SpringBootTest</code>는 <code>@SpringBootApplication</code>이나 <code>@SpringBootConfiguration</code> 중 하나가 반드시 있어야 한다![기본적으로 이 두 어노테이션을 찾기 때문]</li></ul><p id="0486989d-75d9-48f9-89d5-4f41f1b2e535" class="">/코드</p><p id="b9ca280a-4cb5-438b-8ea2-552daba7f22e" class="">
</p><h2 id="a3f22708-2139-4b64-9ea6-db0959bd79f3" class="">02. <code>@WebMvcTest</code></h2><ul id="3fa4afd6-5436-49f2-8035-35a6eca9fa8d" class="bulleted-list"><li>MVC를 위한 테스트</li></ul><ul id="9bb2c143-77c9-48e7-ba94-f88bc87fba09" class="bulleted-list"><li>웹에서 테스트하기 힘든 컨트롤러를 테스트하는 데 적합</li></ul><ul id="8d8f9934-0f40-40b7-9eb5-9bf200f051b9" class="bulleted-list"><li>시큐리티, 필터까지 자동으로 테스트하며 수동으로 추가/삭제까지 가능</li></ul><ul id="b1aaa2f6-8061-44b7-874a-c26a6ba07604" class="bulleted-list"><li><code>@Controller</code>, <code>@ControllerAdvice(에러핸들링)</code> , <code>@JsonComponent</code>, <code>Filter</code> , <code>WebMvcConfigurer</code>, <code>HandlerMethodArgumentResolver</code>만 로드 ▶️ <code>@SpringBootTest보다 가볍게 테스트 가능</code></li></ul><p id="e507c273-1926-48c8-a9ab-8ceb94c739d1" class="">
</p><p id="963bc56c-8b55-48ec-a374-7db86eeb0079" class="">테스트를 위해서 Book 클래스를 만들어보자</p><pre id="cc6b1555-1b75-43da-bbc1-0639d7af8bfa" class="code"><code>package com.example.yaml_setting.domain;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

@Data
@NoArgsConstructor
public class Book {
    private Integer idx;//인덱스
    private String title;//제목
    private LocalDateTime publishedAt;//출판일

    @Builder
    public Book(String title, LocalDateTime publishedAt){
        this.title=title;
        this.publishedAt=publishedAt;
    }

}</code></pre><p id="15567061-4311-4ba2-940d-a70422b739b1" class="">
</p><p id="ec539da0-be40-4e01-a78f-2cc6d73aa5e0" class="">이번에는 <code>/books</code> 로 GET요청 시 현재 BookService 클래스에 책 목록을 요청하여 <code>bookList</code>라는 기본값으로 데이터 값을 넘기는 컨트롤러를 만들자!</p><p id="fa8c83c9-9c5a-494e-955b-54449368a841" class="">(반환되는 뷰 이름: book)</p><p id="aa4c2fc8-36e9-4565-8ee0-69c39b267ffc" class="">그리고 BookService는 인터페이스인데, 이의 구현체는 만들지 않도록 하겠다!</p><pre id="00746cd6-06fd-4b07-90bb-9ab65b745d53" class="code"><code>package com.example.yaml_setting.service;

import com.example.yaml_setting.domain.Book;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public interface BookService {
    List&lt;Book&gt; getBookList();
}</code></pre><pre id="05753eeb-38f3-412c-a898-f6ad4f592702" class="code"><code>package com.example.yaml_setting.controller;

import com.example.yaml_setting.service.BookService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class BookController {

    @Autowired
    private BookService bookService;

    @GetMapping(&quot;/books&quot;)
    public String getBookList(Model model){
        model.addAttribute(&quot;bookList&quot;,bookService.getBookList());
        return &quot;book&quot;;
    }

}</code></pre><pre id="88cf043a-1b09-4dbb-a2d5-b939f51b6646" class="code"><code>package com.example.yaml_setting.controller;

import com.example.yaml_setting.domain.Book;
import com.example.yaml_setting.service.BookService;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MockMvcBuilder;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultHandlers;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;

import java.time.LocalDateTime;
import java.util.Collections;

import static org.hamcrest.Matchers.contains;
import static org.mockito.BDDMockito.given;

@WebMvcTest(BookController.class)//1
class BookControllerTest {

    @Autowired
    private MockMvc mockMvc;//2

    @MockBean
    private BookService bookService;//3

    @Test
    public void bookMvcTest() throws Exception {
        Book book=new Book(&quot;Spring Boot Book&quot;,LocalDateTime.now());


        //4.메서드 반환값을 미리 정의
        given(bookService.getBookList()).willReturn(Collections.singletonList(book));

        //5.실행, 예측과 실제를 비교
        mockMvc.perform(
                MockMvcRequestBuilders.get(&quot;/books&quot;)
        ).andExpect(
                MockMvcResultMatchers.status().is2xxSuccessful()
        ).andExpect(
                MockMvcResultMatchers.view().name(&quot;book&quot;)
        ).andExpect(
                MockMvcResultMatchers.model().attributeDoesNotExist(&quot;bookList&quot;)
        ).andExpect(
                MockMvcResultMatchers.model().attribute(&quot;bookList&quot;,contains(book))
        ).andDo(
                MockMvcResultHandlers.print()
        );

    }
}</code></pre><p id="7fec6c96-803e-40e3-a7e2-530a27850e38" class="">먼저 <code>given(bookService.getBookList()).willReturn(Collections.singletonList(book));</code> 를 확인해보자</p><ul id="c74420f3-a371-4cb9-ba95-3aa0a036ed78" class="bulleted-list"><li><code>given(가짜 결과를 만들 메서드).willReturn(반환값)</code> : <code>메서드의 결과값을 미리 정해둔 것</code></li></ul><p id="320c0f07-59c3-49c6-8837-73a1e18cac79" class="">-이때, given의 패키지는 <code>import static org.mockito.BDDMockito.given</code> 여야 한다!</p><ul id="7d1cb2cc-39ce-44c5-b29b-f891fde309ac" class="bulleted-list"><li><code>MockMvcResultMatchers.view().name(&quot;book&quot;)</code> : 반환되는 뷰의 이름이 &quot;book&quot;인지 테스트</li></ul><ul id="d15ab5bd-1360-452f-a5c7-25ee62f85040" class="bulleted-list"><li><code>MockMvcResultMatchers.model().attributeDoesNotExist(&quot;bookList&quot;)</code> : 모델의 프로퍼티 중 &quot;bookList&quot;라는 프로퍼티가 존재하는지 테스트</li></ul><p id="3385d741-edb7-4a00-9cec-d058a4dc5fee" class="">▶️ 현재 bookList라는 프로퍼티가 가짜 객체를 통해 주입되었기 때문에, 이로 인한 경고가 확인될 것</p><ul id="2dad1397-7f2d-4df1-bd7f-6775c686d4c1" class="bulleted-list"><li><code>MockMvcResultMatchers.model().attribute(&quot;bookList&quot;,contains(book))</code> : 모델의 프로퍼티 중 bookList라는 프로퍼티에 book 객체가 담겨져 있는지 테스트</li></ul><p id="46969f9b-d859-475d-a361-97b77a4910db" class="">-이때, contains의 패키지는 <code>import static org.hamcrest.Matchers.contains;</code> 여야 한다!</p><p id="90b14363-da1b-4567-8f27-46eb2d912a4e" class="">
</p><h2 id="d2fecbf0-9101-4702-b0c2-148de8cbe030" class="">03. <code>@DataJpaTest</code></h2><ul id="f66da1bd-d645-403e-8655-460f48365ec0" class="bulleted-list"><li><code>JPA 관련 테스트 설정만 로드</code></li></ul><ul id="b89a18eb-e7a7-4118-a1d3-6c6e6517fe68" class="bulleted-list"><li>데이터 소스의 설정이 정상적인지 테스트</li></ul><ul id="6435c607-3261-48c1-9acf-0014785f3ce6" class="bulleted-list"><li>JPA를 사용하여 데이터를 제대로 생성, 수정, 삭제하는지 등의 테스트가 가능</li></ul><ul id="8902e342-c8df-43a5-b929-89fa2fbbf96c" class="bulleted-list"><li>내장형 데이터베이스를 사용해서 실제 데이터베이스를 사용하지 않고 테스트 데이터베이스로 테스트 가능</li></ul><ul id="38190215-20f2-453a-bdff-22dc23f3f525" class="bulleted-list"><li>기본적으로 <code>인메모리 임베디드 인터페이스</code>를 사용</li></ul><ul id="03390c69-f47c-4a76-b911-e9811698aae7" class="bulleted-list"><li><code>@Entity</code> 클래스를 스캔해서 스프링 데이터 JPA 저장소(Spring Data JPA Repositories)를 구성</li></ul><ul id="a3a5f7c3-0e76-4b25-91ed-996f24befb01" class="bulleted-list"><li>최적화한 별도의 데이터소스를 사용하고 싶다면 기본 설정된 데이터 소스를 사용하지 않도록 아래와 같이 <code>@AutoConfigureTestDatabase(replace=AutoConfigureTestDatabase.Replace.NONE)</code>을 적용해주면 된다!</li></ul><ul id="433a2b52-0800-4bb1-8d69-69f19dedca5f" class="bulleted-list"><li>테스트 데이터베이스는 <code>@AutoConfigureTestDatabae(connection=H2)</code> 와 같이 설정해서 사용가능하다!</li></ul><pre id="f6aa60a4-a606-40f3-9c2b-73e3585950d8" class="code"><code>package com.example.yaml_setting.repository;

import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.test.context.ActiveProfiles;

import static org.junit.jupiter.api.Assertions.*;

@DataJpaTest
@ActiveProfiles(&quot;...&quot;)
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class BookRepositoryTest {

}</code></pre><p id="0d231e8f-a786-4433-a142-f79c1dd796f7" class="">아니라면 application.yml에서 다음과 같이 변경해줘도 된다!</p><pre id="6d98e00d-866f-456f-bb6e-a2a3328a7138" class="code"><code>spring:
  test:
    database:
      replace:
        NONE</code></pre><p id="08a61ffd-2314-4d3a-844e-2447f93f107a" class="">
</p><p id="fcab1b90-7bc4-442c-ba49-14fa6bf88019" class="">기존의 Book을 엔티티로 만들어주자</p><pre id="c1e1cc1d-0c9d-4d3d-99a6-e7c97d17c42d" class="code"><code>package com.example.yaml_setting.domain;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.*;
import java.time.LocalDateTime;

@Data
@NoArgsConstructor
@Entity
@Table
public class Book {
    @Id
    @GeneratedValue
    private Integer idx;//인덱스
    @Column
    private String title;//제목
    @Column
    private LocalDateTime publishedAt;//출판일

    @Builder
    public Book(String title, LocalDateTime publishedAt){
        this.title=title;
        this.publishedAt=publishedAt;
    }

}</code></pre><p id="6a294be6-13ee-4402-86e4-acca61afc715" class="">그리고 Dao에 해당하는 Repository로써 BookRepository를 만들어주자</p><pre id="dbdc888f-bed9-4983-be0b-55bb5b623a78" class="code"><code>package com.example.yaml_setting.repository;

import com.example.yaml_setting.domain.Book;
import org.springframework.data.jpa.repository.JpaRepository;

public interface BookRepository extends JpaRepository&lt;Book,Integer&gt; {
}</code></pre><p id="814527b1-96c2-491a-8ab9-72b1e427803a" class="">
</p><h3 id="33cdaa55-5dbd-4ca1-9715-f1abd6e09f71" class="">(부록)TestEntityManager</h3><ul id="03d9fdf6-9f0b-40c8-9b31-338bb382974a" class="bulleted-list"><li>DataJpaTest에서 EntityManager의 대체제로써 사용됨</li></ul><figure id="b6db5426-f186-4f72-8030-925d788e0038"><a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.html" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">TestEntityManager (Spring Boot 2.5.3 API)</div><div class="bookmark-description">Alternative to EntityManager for use in JPA tests. Provides a subset ofEntityManager methods that are useful for tests as well as helper methods for common testing tasks such aspersist/flush/find .</div></div><div class="bookmark-href"><img src="https://docs.spring.io/favicon.ico" class="icon bookmark-icon"/>https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.html</div></div></a></figure><p id="f68609cc-84b2-4011-89a6-103194b24284" class="">ⓐ &lt;E&gt; E	persist(E entity)</p><ul id="f5638dde-90c8-4b0c-a0b8-2965e4aa9eef" class="bulleted-list"><li>인스턴스를 관리되고 지속적일 수 있도록 만들어줌</li></ul><p id="62ccb30b-fb06-4d6f-8f3d-25ee16c1f117" class="">
</p><p id="9570485c-213e-49a3-b245-f08253e3917f" class="">ⓑ void	flush()</p><ul id="95f64092-c4b4-4d43-b23d-667fc14c64e6" class="bulleted-list"><li>지속성 컨텍스트를 기본 데이터베이스와 동기화</li></ul><p id="61936ae2-9486-4c36-940a-2c653bbf3b8f" class="">
</p><p id="cc8ab3de-f539-4ab3-a67f-3f26c750911d" class="">ⓒ &lt;E&gt; E	find(Class&lt;E&gt; entityClass, Object primaryKey)</p><ul id="fdbb8c54-8b08-4b0d-a779-77294a2e6602" class="bulleted-list"><li>기본키로 찾기</li></ul><p id="d94b75a6-3fe9-414a-af18-b991dd05f6ed" class="">
</p><p id="26a77993-5482-404b-9231-48dc2fff3abf" class="">TestEntityManager를 이용해서 book 인스턴스를 관리하고 지속적일 수 있도록 설정해주자(persist)</p><pre id="d64a533e-00c3-4879-b9b2-40d8e4f33e6b" class="code"><code>package com.example.yaml_setting.repository;

import com.example.yaml_setting.domain.Book;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManager;

import java.time.LocalDateTime;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.is;

@DataJpaTest
class BookRepositoryTest {

    private final static String BOOT_TEST_TITLE=&quot;Spring Boot Test Book&quot;;

    @Autowired
    private TestEntityManager testEntityManager;

    @Autowired
    private BookRepository bookRepository;

    @Test
    public void bookSaveTest(){
        Book book= Book.builder().title(BOOT_TEST_TITLE).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book);
        assertThat(bookRepository.getOne(book.getIdx()),is(book));
    }
}</code></pre><p id="07905aed-ad10-45ec-bc6b-d9fc522bb34f" class="">
</p><p id="d23dceb4-b863-4af2-9b18-ab2472b2f3e3" class="">이번에는 Book 인스턴스 3개를 저장하고, 그 갯수가 3개가 맞는지, 저장된 Book에 각 Book 객체가 모두 포함되어 있는지 테스트해보자</p><pre id="ad0f8986-a09b-4d79-bdec-e084d7f91bec" class="code"><code>package com.example.yaml_setting.repository;

import com.example.yaml_setting.domain.Book;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManager;

import java.time.LocalDateTime;
import java.util.List;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.*;

@DataJpaTest
class BookRepositoryTest {

    private final static String BOOT_TEST_TITLE=&quot;Spring Boot Test Book&quot;;

    @Autowired
    private TestEntityManager testEntityManager;

    @Autowired
    private BookRepository bookRepository;

    @Test
    public void bookSaveTest(){
        Book book= Book.builder().title(BOOT_TEST_TITLE).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book);
        assertThat(bookRepository.getOne(book.getIdx()),is(book));
    }

    @Test
    public void bookSaveSearchTest(){
        Book book1= Book.builder().title(BOOT_TEST_TITLE+&quot; 1&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book1);
        Book book2= Book.builder().title(BOOT_TEST_TITLE+&quot; 2&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book2);
        Book book3= Book.builder().title(BOOT_TEST_TITLE+&quot; 3&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book3);

        List&lt;Book&gt; bookList=bookRepository.findAll();
        assertThat(bookList,hasSize(3));
        assertThat(bookList,contains(book1,book2,book3));
    }
}</code></pre><p id="b46f5a53-55c8-4fe0-87c4-cad84baaf67a" class="">
</p><p id="3f47650c-2b46-470a-a064-dee8dd50eb84" class="">이번에는 저장된 Book 중 2개가 제대로 삭제되는 지 테스트해보자</p><pre id="745d58d3-61ee-4165-8af4-566b7d482c84" class="code"><code>package com.example.yaml_setting.repository;

import com.example.yaml_setting.domain.Book;
import org.assertj.core.util.Lists;
import org.hamcrest.collection.IsEmptyCollection;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManager;

import java.time.LocalDateTime;
import java.util.List;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.*;

@DataJpaTest
class BookRepositoryTest {

    private final static String BOOT_TEST_TITLE=&quot;Spring Boot Test Book&quot;;

    @Autowired
    private TestEntityManager testEntityManager;

    @Autowired
    private BookRepository bookRepository;

    @Test
    public void bookSaveTest(){
        Book book= Book.builder().title(BOOT_TEST_TITLE).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book);
        assertThat(bookRepository.getOne(book.getIdx()),is(book));
    }

    @Test
    public void bookSaveSearchTest(){
        Book book1= Book.builder().title(BOOT_TEST_TITLE+&quot; 1&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book1);
        Book book2= Book.builder().title(BOOT_TEST_TITLE+&quot; 2&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book2);
        Book book3= Book.builder().title(BOOT_TEST_TITLE+&quot; 3&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book3);

        List&lt;Book&gt; bookList=bookRepository.findAll();
        assertThat(bookList,hasSize(3));
        assertThat(bookList,contains(book1,book2,book3));
    }

    @Test
    public void bookListSaveAndDelete(){
        Book book1= Book.builder().title(BOOT_TEST_TITLE+&quot; 1&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book1);
        Book book2= Book.builder().title(BOOT_TEST_TITLE+&quot; 2&quot;).publishedAt(LocalDateTime.now()).build();
        testEntityManager.persist(book2);


        bookRepository.deleteAllInBatch();
        assertThat(bookRepository.findAll(),IsEmptyCollection.empty());
    }

}</code></pre><p id="02e975de-3e65-486c-8579-bf9911e9534b" class="">
</p><h2 id="a308e4b6-6955-4131-922c-4a8653d22c12" class="">04. <code>@RestClientTest</code></h2><ul id="00e5e6de-4a42-4b8a-8101-6349b649a5b9" class="bulleted-list"><li>REST 관련 테스트를 도와줌</li></ul><ul id="67208685-6435-4af9-a107-ea7d842c24cc" class="bulleted-list"><li>REST 통신의 데이터형으로 사용되는 JSON 형식이 예상대로 응답을 반환하는지 등을 테스트 가능</li></ul><p id="ea45c631-e4ef-43e4-aa2f-d6f9753fd799" class="">
</p><p id="b76c94da-0f79-4f4e-89ca-653534c604af" class="">먼저, REST 통신을 위해서 서비스단에서 URI를 만들어서 RestTemplate을 사용하자</p><pre id="0d62f451-5678-4836-af13-a485715a2527" class="code"><code>package com.example.yaml_setting.service;

import com.example.yaml_setting.domain.Book;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.util.UriComponentsBuilder;

import java.net.URI;

@Service
public class BookRestService {

		private final RestTemplate restTemplate;

		public BookRestService(RestTemplateBuilder builder){
			this.restTemplate=builder.rootUri(&quot;/rest/test&quot;).build();
   }

    public Book getRestBook(){

        return restTemplate.getForObject(&quot;/rest/test&quot;,Book.class);
    }
}</code></pre><p id="782ea348-d229-4857-9600-c197afba703c" class="">
</p><p id="d8af1cb4-a722-4086-b6bb-0cc7ea7fb2ab" class="">이런 서비스단을 기반으로 REST 컨트롤러를 만들어보자</p><pre id="85ed4598-3fee-4456-a055-d8b5f37f1d3f" class="code"><code>package com.example.yaml_setting.controller;

import com.example.yaml_setting.domain.Book;
import com.example.yaml_setting.service.BookRestService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class BookRestController {

    @Autowired
    private BookRestService bookRestService;

    @GetMapping(value=&quot;/rest/test&quot;, produces = {MediaType.APPLICATION_JSON_VALUE})
    public Book getRestBooks(){
        return bookRestService.getRestBook();
    }
}</code></pre><pre id="5a575b59-3b07-40b1-84d8-b58788b75c22" class="code"><code>{
  &quot;idx&quot;: null,
  &quot;title&quot;: &quot;테스트&quot;,
  &quot;publishedAt&quot;: null
}</code></pre><p id="492dc355-f5e6-4a50-823b-e93b1740722c" class="">-위는 test용 json 데이터 test.json이다</p><p id="4d060a0e-eb15-4cce-8332-c25f9405c75f" class="">
</p><p id="4c16c086-3ae9-443a-aec1-4b6bdb93661a" class="">서비스에 대해서 &quot;/rest/test&quot;에 요청을 던졌을 때,  응답이 test.json일 것이라고 예측하고</p><p id="917dfbe5-889d-49a8-baa1-346e68b5ba30" class="">title값이 &quot;테스트&quot;인지 확인해보자</p><pre id="5192eccc-5a32-48fd-95b7-5df14ef9b22a" class="code"><code>package com.example.yaml_setting.service;

import com.example.yaml_setting.domain.Book;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.internal.junit.JUnitRule;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.client.RestClientTest;
import org.springframework.core.io.ClassPathResource;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit.jupiter.SpringExtension;
import org.springframework.test.web.client.MockRestServiceServer;
import org.springframework.test.web.client.match.MockRestRequestMatchers;
import org.springframework.test.web.client.response.MockRestResponseCreators;

import static org.assertj.core.api.Assertions.assertThat;


@RestClientTest(BookRestService.class)
class BookRestServiceTest {

    @Autowired
    private BookRestService bookRestService;

    @Autowired
    private MockRestServiceServer server;

    @Test
    public void restTest(){
        server.expect(
                MockRestRequestMatchers.requestTo(&quot;/rest/test&quot;)
        ).andRespond(
                MockRestResponseCreators.withSuccess(new ClassPathResource(&quot;/test.json&quot;,getClass()), MediaType.APPLICATION_JSON)
        );

        Book book = this.bookRestService.getRestBook();
        assertThat(book.getTitle()).isEqualTo(&quot;테스트&quot;);
    }

}</code></pre><p id="cbcb22d2-4c66-44a1-b0ef-56f6b6b2e3f8" class="">먼저 JUnit4에서는 <code>@Rule</code>을 이용하는 방식이 있는데 JUnit5는 해당 방식을 사용하지 않고 위와 같이 진행이 가능하다!</p><p id="1867265f-c878-48e4-93c9-d6c17dc560e9" class="">[Rule로 지정한 필드값은 하나의 테스트 메서드가 끝날 때마다 정의한 값으로 초기화해줌]</p><p id="76907905-5008-4a28-84e6-fd863f5011cc" class="">
</p><p id="c0763420-f8f6-4296-8e08-5aec6ce64389" class="">ⓐ MockRestServiceServer : 클라이언트-서버 간 REST 테스트를 위한 객체</p><p id="618f229b-d109-48cd-ae7b-a4ba5cf17c2e" class="">ⓑ expect: mockMvc의 perform과 유사한 기능!</p><p id="c4b5b01e-43b8-403b-bc0b-8930decb0050" class="">ⓒ andRespond: 응답하기</p><p id="30a7c5dd-9ba1-43fc-a081-6be223e5a3e7" class=""><code>MockRestResponseCreators.withSuccess(new ClassPathResource(&quot;/test.json&quot;,getClass()), MediaType.APPLICATION_JSON)</code> - 성공 시, test.json을 가져와서 json 형태로 응답</p><p id="65ff4e3f-6761-4d1b-8b67-a4cb3a8d1dc7" class="">
</p><p id="02f5d8b1-4df3-4bea-b580-a8fa5eb44d98" class="">ⓓ <code>assertThat(book.getTitle()).isEqualTo(&quot;테스트&quot;);</code> : c의 응답 중 title 값이 &quot;테스트&quot;와 일치하는지 비교</p><p id="527d4097-1963-4d79-b05d-86354bdd8154" class="">
</p><p id="13718fe4-c31b-4b2c-a61c-9ddf78000f7e" class="">이번에는 에러를 발생시키고 이 에러가 HttpServerErrorException과 같은지 비교하도록 해보자</p><p id="b01dd404-bd51-4e2d-8b89-da2317e66a09" class="">🌟 JUnit5에서는 4버전과 다르게, ExpectedException이 지원되지 않아, <code>assertThrows</code>를 이용하자</p><figure id="c569eca9-9bde-4dce-a082-0b40be286096"><a href="https://howtodoinjava.com/junit5/expected-exception-example/" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">JUnit 5 Expected Exception - assertThrows() Example</div><div class="bookmark-description">In JUnit 5, to test a method which throws an exception, we should use Assertions.assertThrows(). @Test void testExpectedException() { Assertions.assertThrows(ApplicationException.class, () -&gt; { //Code under test }); } The assertThrows() method asserts that execution of the supplied executable block or lambda expression throws an exception of the expectedType.</div></div><div class="bookmark-href"><img src="https://howtodoinjava.com/wp-content/uploads/2015/05/howtodoinjava_logo-55696c1cv1_site_icon-256x256.png" class="icon bookmark-icon"/>https://howtodoinjava.com/junit5/expected-exception-example/</div></div><img src="https://howtodoinjava.com/wp-content/uploads/2017/05/JUnit-5-Expected-Exception-Tests.png" class="bookmark-image"/></a></figure><pre id="f853763b-bd5f-45ad-bb1c-af0d83699aad" class="code"><code>package com.example.yaml_setting.service;

import com.example.yaml_setting.domain.Book;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.client.RestClientTest;
import org.springframework.core.io.ClassPathResource;
import org.springframework.http.MediaType;
import org.springframework.test.web.client.MockRestServiceServer;
import org.springframework.test.web.client.match.MockRestRequestMatchers;
import org.springframework.test.web.client.response.MockRestResponseCreators;
import org.springframework.web.client.HttpServerErrorException;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertThrows;

@RestClientTest(BookRestService.class)
class BookRestServiceTest {

    @Autowired
    private BookRestService bookRestService;

    @Autowired
    private MockRestServiceServer server;

    @Test
    public void restTest(){
        server.expect(
                MockRestRequestMatchers.requestTo(&quot;/rest/test&quot;)
        ).andRespond(
                MockRestResponseCreators.withSuccess(new ClassPathResource(&quot;/test.json&quot;,getClass()), MediaType.APPLICATION_JSON)
        );

        Book book = this.bookRestService.getRestBook();
        assertThat(book.getTitle()).isEqualTo(&quot;테스트&quot;);
    }

    @Test
    public void restErrorTest(){
        server.expect(
                MockRestRequestMatchers.requestTo(&quot;/rest/test&quot;)
        ).andRespond(
                MockRestResponseCreators.withServerError()
        );

        assertThrows(HttpServerErrorException.class,()-&gt;{
            bookRestService.getRestBook();
        });
    }

}</code></pre><p id="6d32e7c0-f8f8-43a8-8642-fc1a89d6bea1" class="">
</p><ul id="d064fb50-f5f3-4287-a526-6347833dc579" class="bulleted-list"><li>MockRestResponseCreators.withServerError() : 500 상태로 응답을 내려줌</li></ul><ul id="f8bfebfb-2cf9-49ac-a898-db4f7a91d1a8" class="bulleted-list"><li>MockRestResponseCreators.withUnauthorizedRequest() : 401(UNAUTHORIZED) 상태로 응답을 내려줌</li></ul><ul id="c04bea0c-2581-48b5-8a5c-524a164a9ba9" class="bulleted-list"><li>MockRestResponseCreators.withBadRequest(): 400(BAD_REQUEST) 상태로 응답을 내려줌</li></ul><ul id="d5c45d48-0fe7-416a-9263-a010031096bc" class="bulleted-list"><li>MockRestResponseCreators.withSuccess(Resource body, @Nullable MediaType contentType) : 200 상태로 Resource 기반 바디로 응답을 내려줌</li></ul><ul id="33513b12-51d0-49e0-ad80-019c81799c17" class="bulleted-list"><li>MockRestResponseCreators.withCreatedEntity(URI location) : 201(CREATED) 상태로 응답을 내려줌</li></ul><figure id="4bbc1707-c646-4738-819b-a1da8406cb6d"><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/client/response/MockRestResponseCreators.html#withServerError--" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">MockRestResponseCreators (Spring Framework 5.3.9 API)</div><div class="bookmark-description">org.springframework.test.web.client.response.MockRestResponseCreators</div></div><div class="bookmark-href"><img src="https://docs.spring.io/favicon.ico" class="icon bookmark-icon"/>https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/client/response/MockRestResponseCreators.html#withServerError--</div></div></a></figure><p id="969b8c06-740d-4612-813f-c91ea4650076" class="">
</p><h2 id="68e59135-6679-4973-bea5-76821ac63bd5" class="">05. <code>@JsonTest</code></h2><ul id="c974b9fd-d174-4d4a-adb2-b9d0ca0cf4c2" class="bulleted-list"><li>json 테스트를 지원</li></ul><ul id="11fbfa15-e9dd-4581-9bd1-dd867bbd219e" class="bulleted-list"><li>Gson과 Jackson의 테스트를 제공(각각 GsonTester와 JacksonTester를 사용)</li></ul><ul id="83a4dd3a-01ab-4b10-b4f5-f58d44975448" class="bulleted-list"><li>JSON 테스트 종류</li></ul><p id="3612ff33-9f95-4da4-a084-493157472a32" class="">(1) 문자열로 나열된 JSON 데이터 ▶️ 객체로 변환[역직렬화]</p><p id="a7b12ffb-12b9-4429-98b0-1d90df8a950a" class="">(2) 객체 ▶️ 문자열로 나열된 JSON 데이터[직렬화]</p><p id="a34005af-d58e-4c88-8db5-183a8036816a" class="">다시 한번! test.json</p><pre id="751f054d-1272-41d3-9686-09fee0d06db7" class="code"><code>{
  &quot;idx&quot;: null,
  &quot;title&quot;: &quot;테스트&quot;,
  &quot;publishedAt&quot;: null
}</code></pre><pre id="bedc41d4-0182-42ef-b75f-f00452ca860c" class="code"><code>package com.example.yaml_setting;

import com.example.yaml_setting.domain.Book;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.json.JsonTest;
import org.springframework.boot.test.json.JacksonTester;

import java.io.IOException;

import static org.assertj.core.api.Assertions.assertThat;


@JsonTest
public class BookJsonTest {

    @Autowired
    private JacksonTester&lt;Book&gt; json;

    @Test
    public void jsonTest() throws IOException {
        Book book= Book.builder().title(&quot;테스트&quot;).build();//인자가 2개거나 없거나 해야할텐데 그래서 에러날것(cuz 생성자)

        String content=&quot;{\&quot;title\&quot;:\&quot;테스트\&quot;}&quot;;

        assertThat(this.json.parseObject(content).getTitle()).isEqualTo(book.getTitle());
        assertThat(this.json.parseObject(content).getPublishedAt()).isNull();

        //각 필드를 변환한 문자열이 test.json파일에 정의한 내용과 일치하는지 테스트
        assertThat(this.json.write(book)).isEqualTo(&quot;/test.json&quot;);
        //title값이 있는지 확인
        assertThat(this.json.write(book)).hasJsonPathStringValue(&quot;title&quot;);
        //title값이 일치하는지 확인
        assertThat(this.json.write(book)).extractingJsonPathStringValue(&quot;title&quot;).isEqualTo(&quot;테스트&quot;);

    }
}</code></pre><p id="718f2603-d7cd-4e48-b95f-d1d700986b5c" class="">
</p><p id="2f9759e4-e220-4afc-825e-8e6458021bba" class="">🌟public T parseObject(byte[] jsonBytes) : JSON 문자열 데이터 ▶️ 자바 객체(역직렬화)</p><p id="f28e7674-304c-44fe-ae92-92dc9af5a4b6" class="">🌟public JsonContent&lt;T&gt; write(T value) : 자바 객체 ▶️ JSON 문자열 데이터</p><p id="d5fa3a63-fd12-467e-a351-d8f4e8b39d3b" class="">
</p><figure id="9fb6b143-f332-477b-b907-0a9327fb9d1c"><a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/json/AbstractJsonMarshalTester.html#write-T-" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">AbstractJsonMarshalTester (Spring Boot 2.5.3 API)</div><div class="bookmark-description">public class ExampleObjectJsonTests { private AbstractJsonTester json = //... @Test public void testWriteJson() { ExampleObject object = //... assertThat(json.write(object)).isEqualToJson(&quot;expected.json&quot;); assertThat(json.read(&quot;expected.json&quot;)).isEqualTo(object); } } For a complete list of supported assertions see</div></div><div class="bookmark-href"><img src="https://docs.spring.io/favicon.ico" class="icon bookmark-icon"/>https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/json/AbstractJsonMarshalTester.html#write-T-</div></div></a></figure><p id="d2bcee89-79f3-4645-b151-e7d2eeb2000e" class="">
</p><p id="94f6a045-396f-4a89-8ee5-bd5bb8ac3dd5" class="">가. 여기는 역직렬화 결과를 이용</p><p id="5298a0e6-9860-4dc8-b6e5-b82b9535c1f1" class="">ⓐ <code>assertThat(this.json.parseObject(content).getTitle()).isEqualTo(book.getTitle());</code></p><ul id="3670730d-3d8e-4076-b663-633ae061e8bf" class="bulleted-list"><li>자바 객체로 바뀐 json 데이터로부터 title값을 가져와서 book 인스턴스의 title값과 같은지 확인</li></ul><p id="b9c05d6f-e6aa-4257-92a1-70fd71285c35" class="">
</p><p id="d0d0daa1-d654-4f4f-84bb-e4f1e1dc8c58" class="">ⓑ <code>assertThat(this.json.parseObject(content).getPublishedAt()).isNull();</code></p><ul id="e2109dbe-97b2-427a-9e80-2b0a89e76a7a" class="bulleted-list"><li>json 데이터로부터 자바 객체로 바뀐 결과에서 publishedAt값이 비어있는지 확인</li></ul><p id="0cb46706-36da-4362-91d5-f7f09159964a" class="">
</p><p id="ceba02ea-d9bc-4f7c-8102-d6e279bbe72c" class="">나. 여기는 직렬화 결과를 이용</p><p id="61f01e75-18b9-4356-abd4-bdc4c6568a29" class="">ⓒ <code>assertThat(this.json.write(book)).isEqualTo(&quot;/test.json&quot;);</code></p><ul id="e08cf632-028c-4cd4-9b77-1eedad36a027" class="bulleted-list"><li>객체를 json 데이터로 바뀐 결과가 test.json파일에 정의한 내용과 일치하는지 테스트</li></ul><p id="e18ba2c0-2ba6-4f28-afb3-bb69170330d8" class="">
</p><p id="57cb1adf-3939-4d70-a91b-d0a74e628d82" class="">ⓓ <code>assertThat(this.json.write(book)).hasJsonPathStringValue(&quot;title&quot;);</code></p><ul id="73f16206-0085-46ff-ba3b-b8218d9aeba8" class="bulleted-list"><li>객체를 json 데이터로 바뀐 결과에 title 필드가 있는지 확인</li></ul><p id="f1d3cdf3-6a75-4fa7-b55e-4a89749bcef1" class="">
</p><p id="539a3168-13f4-4f1e-927a-36d15a2a8942" class="">ⓔ <code>assertThat(this.json.write(book)).extractingJsonPathStringValue(&quot;title&quot;).isEqualTo(&quot;테스트&quot;);</code></p><ul id="275332bb-6b40-4a12-9dc2-129dbd18ea8b" class="bulleted-list"><li>객체를 json 데이터로 바뀐 결과의 title 필드값을 추출하고, 그 값이 &quot;테스트&quot;와 일치하는지 확인</li></ul></div></article></body></html>